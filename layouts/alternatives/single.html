<!DOCTYPE html>
<html lang="en">

<head>
  <title>{{ .Params.pagetitle }} </title>
  <link rel="preconnect" href="https://gstatic.com" crossorigin>
  <link rel="preconnect" href="https://google-analytics.com">
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://googletagmanager.com">
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preload" href="/images/vector.png" as="image" media="(min-width: 601px)">
  <link rel="preload" href="/images/logo.svg" as="image" media="(min-width: 601px)">
  <link rel="preload" href="/images/bg-fon.png" as="image" media="(min-width: 601px)">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="{{ .Params.metadescription | plainify | truncate 160 }}">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap" rel="preload" as="style">
  <link rel="stylesheet" href="{{ "/assets/css/tooltipster/tooltipster.bundle.min.css" | relURL }}" >
  <link rel="stylesheet" href="{{ "/assets/css/main.css" | relURL }}" >
  <link rel="canonical" href="{{ .Permalink }}">
  <meta property="og:title"
    content="{{ if .Params.pagetitle }}{{ .Params.pagetitle | htmlEscape }}{{ else }}{{ .Site.Title | htmlEscape }}{{ end }}" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="{{ .Permalink }}" />
  <meta property="og:description"
    content="{{ if .Params.excerpt }}{{ .Params.excerpt | plainify | truncate 160 }}{{ else }}{{ .Site.Params.description }}{{ end }}" />
  <meta property="og:image"
    content="{{ if .Params.og }}{{ .Site.BaseURL }}{{ .Params.og }}{{ else }}{{ .Site.BaseURL }}/images/og.png{{ end }}" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@defiprime">
  <meta name="twitter:creator" content="@defiprime">
  <meta name="twitter:title"
    content="{{ if .Params.pagetitle }}{{ .Params.pagetitle | htmlEscape }}{{ else }}{{ .Site.Title | htmlEscape }}{{ end }}">
  <meta name="twitter:description" content="{{ .Params.metadescription | plainify | truncate 160 }}">
  <meta name="twitter:image"
    content="{{ if .Params.og }}{{ .Site.BaseURL }}{{ .Params.og }}{{ else }}{{ .Site.BaseURL }}/images/og.png{{ end }}">
  <script defer src="https://use.fontawesome.com/releases/v5.8.1/js/all.js"
    integrity="sha384-g5uSoOSBd7KkhAMlnQILrecXvzst9TdC09/VM+pjDTCM+1il8RHz5fKANTFFb+gQ"
    crossorigin="anonymous"></script>
  <!-- Google Tag Manager -->
  <script>(function (w, d, s, l, i) {
      w[l] = w[l] || []; w[l].push({
        'gtm.start':
          new Date().getTime(), event: 'gtm.js'
      }); var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
          'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-PB9GWJD');</script>
  <!-- End Google Tag Manager -->
</head>

{{ $alternativeTo := index .Params "alternative-to" }}
{{ $all_projects := where site.RegularPages "Section" "alternative-savings" }}
{{ $all_projects = $all_projects | append (where site.RegularPages "Section" "analytics") }}
{{ $all_projects = $all_projects | append (where site.RegularPages "Section" "assets-management-tools") }}
{{ $all_projects = $all_projects | append (where site.RegularPages "Section" "assets-tokenization") }}
{{ $all_projects = $all_projects | append (where site.RegularPages "Section" "dao") }}
{{ $all_projects = $all_projects | append (where site.RegularPages "Section" "derivatives") }}
{{ $all_projects = $all_projects | append (where site.RegularPages "Section" "exchanges") }}
{{ $all_projects = $all_projects | append (where site.RegularPages "Section" "infrastructure") }}
{{ $all_projects = $all_projects | append (where site.RegularPages "Section" "insurance") }}
{{ $all_projects = $all_projects | append (where site.RegularPages "Section" "kyc_identity") }}
{{ $all_projects = $all_projects | append (where site.RegularPages "Section" "lending") }}
{{ $all_projects = $all_projects | append (where site.RegularPages "Section" "perps") }}
{{ $all_projects = $all_projects | append (where site.RegularPages "Section" "marketplaces") }}
{{ $all_projects = $all_projects | append (where site.RegularPages "Section" "payments") }}
{{ $all_projects = $all_projects | append (where site.RegularPages "Section" "prediction_markets") }}
{{ $all_projects = $all_projects | append (where site.RegularPages "Section" "stablecoins") }}
{{ $page_cards := where $all_projects "Params.alternative-to" $alternativeTo }}

<body class="product-page">

  {{ partialCached "header.html" . }}
  <!-- Main -->
  <div id="main">
    <div class="inner">
      <article class="article  article--post  content  typeset">

        <h1>{{ .Params.h1title }}</h1>

        <div class="custodian_description">
          {{ .Content }}
        </div>

        {{ if index .Params "filter-by" }}
        {{ $items_filters := split (index .Params "filter-by") ", " }}
        <section>
          <div class="button-group filters-button-group">
            <button class="button active" data-filter="*">All</button>
            {{ range $items_filters }}
            {{ $filter := . }}
            {{ $filter_buttons := slice }}
            {{ range $page_cards }}
              {{ $val := index .Params $filter }}
              {{ if $val }}
                {{ $filter_buttons = $filter_buttons | append $val }}
              {{ end }}
            {{ end }}
            {{ $filter_buttons = $filter_buttons | uniq }}
            {{ range $filter_buttons }}
            <button class="button"
              data-filter="{{ . | lower | replace " " "-" }}">{{ . }}</button>
            {{ end }}
            {{ end }}
          </div>
        </section>
        {{ end }}

        {{ $items_filters := slice }}
        {{ if index .Params "filter-by" }}
          {{ $items_filters = split (index .Params "filter-by") ", " }}
        {{ end }}
        {{ $featured := where $page_cards "Params.featured" true }}
        {{ $non_featured := where $page_cards "Params.featured" "ne" true }}
        {{ $sorted_cards := $featured | append $non_featured }}

        <section id='assets_cards'>
          {{ range $sorted_cards }}
          {{ $asset_tool := . }}
          {{ $card_filters := slice }}
          {{ range $items_filters }}
            {{ $filter := . }}
            {{ $val := index $asset_tool.Params $filter | lower | replace " " "-" }}
            {{ if $val }}
              {{ $card_filters = $card_filters | append $val }}
            {{ end }}
          {{ end }}

          {{ if $asset_tool.Params.featured }}
          <div class="article-wrapper featured-wrapper">
            <article class="asset_tool_card {{ delimit $card_filters " " }}">
            <div class="featured-header">
              <span class="featured-product">

                Featured product
              </span>

              <span class="sponsored">
                Sponsored
              </span>
            </div>
          {{ else }}
          <div class="article-wrapper">
            <article class="asset_tool_card {{ delimit $card_filters " " }}">
          {{ end }}


                <a href="{{ index $asset_tool.Params "product-url" }}" target="_blank" rel="noopener">
                  <img src="{{ $asset_tool.Params.image }}">
                  <button class="visit-website">Visit website</button>
                </a>
                <div class="card_main_details">
                  <h4><a href="{{ index $asset_tool.Params "product-url" }}" target="_blank"
                    rel="noopener">{{ index $asset_tool.Params "product-title" }}</a></h4>
                  <div class="asset-tool-tags">
                    {{ $market_tags := split (index $asset_tool.Params "ecosystem") ", " }}
                    {{ range $market_tags }}
                    {{ $market_tag := . }}
                    {{ if eq $market_tag "ethereum" }}
                    <span class="tooltip" title="Built on Ethereum or related to Ethereum ecosystem">
                      {{ partial "icons/eth.svg" $ }}
                    </span>
                    {{ else if eq $market_tag "bsc" }}
                    <span class="tooltip" title="Built on BSC or related to BSC ecosystem">
                      {{ partial "icons/binance.svg" $ }}
                    </span>
                    {{ else if eq $market_tag "bitcoin" }}
                    <span class="tooltip" title="Using Bitcoin ecosystem">
                      {{ partial "icons/bitcoin.svg" $ }}
                    </span>
                    {{ else if eq $market_tag "tron" }}
                    <span class="tooltip" title="Built on Tron or related to Tron ecosystem">
                      {{ partial "icons/tron.svg" $ }}
                    </span>
                    {{ else if eq $market_tag "stellar" }}
                    <span class="tooltip" title="Built on Stellar or related to Stellar ecosystem">
                      {{ partial "icons/stellar.svg" $ }}
                    </span>
                    {{ else if eq $market_tag "eos" }}
                    <span class="tooltip" title="Built on EOS or related to EOS ecosystem">
                      {{ partial "icons/eos.svg" $ }}
                    </span>
                    {{ end }}
                    {{ end }}
                    <div class="tags_separator"></div>
                    {{ $platform_tags := split (index $asset_tool.Params "platform") ", " }}
                    {{ range $platform_tags }}
                    {{ $platform_tag := . }}
                    {{ if eq $platform_tag "android" }}
                    <span class="tooltip" title="Mobile wallet for Android">
                      {{ partial "icons/android.svg" $ }}
                    </span>
                    {{ else if eq $platform_tag "web" }}
                    <span class="tooltip" title="Browser based wallet">
                      {{ partial "icons/web.svg" $ }}
                    </span>
                    {{ else if eq $platform_tag "ios" }}
                    <span class="tooltip" title="Mobile wallet for iOS">
                      {{ partial "icons/ios.svg" $ }}
                    </span>
                    {{ end }}
                    {{ end }}
                    {{ $type_tags := split (index $asset_tool.Params "product-type") ", " }}
                    {{ range $type_tags }}
                    {{ if eq . "cefi" }}
                    <span class="tooltip"
                      title="CeFi product. CeFi products are custodial, use centralized price feeds, initiate margin calls centrally, centrally determine interest rates, and centrally provide liquidity for their margin calls.">
                      {{ partial "icons/cefi.svg" $ }}
                    </span>
                    {{ else }}
                    <span class="tooltip" title="Non-custodial">
                      {{ partial "icons/non-custodial.svg" $ }}
                    </span>
                    {{ end }}
                    {{ end }}
                  </div>
                  <p>{{ index $asset_tool.Params "product-description" | markdownify | replaceRE "</?p>" "" }}
                  </p>
                  <div title="Would you recommend this product?" class="comments">
                    <a href="/product/{{ index $asset_tool.Params "product-title" | urlize }}">
                      {{ partial "icons/comment.svg" $ }}
                      <span class="gc-counter"
                        data-url="{{ $.Site.BaseURL }}/product/{{ index $asset_tool.Params "product-title" | urlize }}">0</span>
                      <span class="tip"><span class="icon">ðŸ‘ˆ</span> What do you think?</span>
                    </a>
                  </div>
                </div>
              </article>
            </div> <!--  /div end for div.article-wrapper -->

            {{ end }}
        </section>

      </article>

      <script defer src="/assets/js/page.js"></script>

      <!--
    Include this javascript code after your .gc-counters elements
-->
      <script type="text/javascript">

        /* - - - CONFIGURATION VARIABLES - - - */

        var website = 'defiprime_prod';

        /* - - - DON'T EDIT BELOW THIS LINE - - - */

        // get all counters
        var counters = document.querySelectorAll('.gc-counter');
        Array.prototype.forEach.call(counters, function (counter) {
          var url = counter.dataset.url;
          var uid = counter.dataset.uid;
          var req = new XMLHttpRequest();

          // called when the ajax request is completed
          req.onreadystatechange = function () {
            if (this.readyState == 4) {
              if (this.status === 200) {
                try {
                  var resp = JSON.parse(this.responseText);
                } catch (e) {
                  console.error(
                    '[gc-counter] fail to decode response "' + this.responseText + '", using url "' + url + '"'
                  );
                  return;
                }
                if (typeof resp.count !== 'undefined') {
                  // write count
                  counter.textContent = resp.count;
                  if (resp.count > 0) {
                    counter.className += " gc-active-comment";
                  }
                }
              } else {
                console.error(
                  '[gc-counter] invalid url "' + url + '", this url is not rattached to a GraphComment page.'
                );
              }
            }
          }

          // send ajax request
          var query = 'website=' + encodeURIComponent(website)
            + '&url=' + encodeURIComponent(url)
            + (uid ? '&uid=' + encodeURIComponent(uid) : '')
            ;
          req.open('GET', 'https://graphcomment.com/api/pub/numberOfComments?' + query, true);
          req.send();
        });
      </script>
    </div>
  </div>
  {{ partial "also.html" . }}
  {{ partialCached "footer.html" . }}

  <script>
  document.addEventListener('DOMContentLoaded', function() {
    // Configuration
    const ITEMS_PER_PAGE = 12;
    const COLLECTIONS = [
      { name: 'exchanges', url: '/exchanges' },
      { name: 'lending', url: '/decentralized-lending' },
      { name: 'yield-aggregators', url: '/yield-aggregators' },
      { name: 'derivatives', url: '/derivatives' },
      { name: 'analytics', url: '/defi-analytics' },
      { name: 'infrastructure', url: '/infrastructure' },
      { name: 'dao', url: '/dao' },
      { name: 'insurance', url: '/insurance' },
      { name: 'kyc_identity', url: '/decentralized_kyc_identity' },
      { name: 'perps', url: '/perps' },
      { name: 'marketplaces', url: '/decentralized_marketplaces' },
      { name: 'payments', url: '/payments' },
      { name: 'prediction_markets', url: '/prediction-markets' },
      { name: 'stablecoins', url: '/stablecoins' },
      { name: 'staking', url: '/staking' },
      { name: 'assets-management-tools', url: '/assets-management-tools' },
      { name: 'assets-tokenization', url: '/assets-tokenization' },
      { name: 'alternative-savings', url: '/alternative-savings' }
    ];

    let allAlternatives = [];
    let filteredAlternatives = [];
    let currentPage = 1;
    let currentCategory = '';
    let currentSearch = '';

    // Load all alternatives
    async function loadAlternatives() {
      const alternatives = [];

      for (const collection of COLLECTIONS) {
        try {
          const response = await fetch(collection.url);
          if (response.ok) {
            const html = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');

            // Extract alternatives from the page
            const cards = doc.querySelectorAll('.card');
            cards.forEach(card => {
              const titleElement = card.querySelector('.card__title a, .card__title');
              const descriptionElement = card.querySelector('.card__description');
              const linkElement = card.querySelector('.card__title a');
              const imageElement = card.querySelector('.card__image img');

              if (titleElement) {
                alternatives.push({
                  title: titleElement.textContent.trim(),
                  description: descriptionElement ? descriptionElement.textContent.trim() : '',
                  url: linkElement ? linkElement.href : '',
                  image: imageElement ? imageElement.src : '',
                  category: collection.name
                });
              }
            });
          }
        } catch (error) {
          console.warn(`Failed to load ${collection.name}:`, error);
        }
      }

      allAlternatives = alternatives;
      filteredAlternatives = [...allAlternatives];
      renderAlternatives();
      renderPagination();
    }

    // Filter alternatives
    function filterAlternatives() {
      filteredAlternatives = allAlternatives.filter(alt => {
        const matchesCategory = !currentCategory || alt.category === currentCategory;
        const matchesSearch = !currentSearch ||
          alt.title.toLowerCase().includes(currentSearch.toLowerCase()) ||
          alt.description.toLowerCase().includes(currentSearch.toLowerCase());
        return matchesCategory && matchesSearch;
      });

      currentPage = 1;
      renderAlternatives();
      renderPagination();
    }

    // Render alternatives
    function renderAlternatives() {
      const grid = document.getElementById('alternatives-grid');
      if (!grid) return;

      const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
      const endIndex = startIndex + ITEMS_PER_PAGE;
      const pageAlternatives = filteredAlternatives.slice(startIndex, endIndex);

      if (pageAlternatives.length === 0) {
        grid.innerHTML = '<div class="no-results">No alternatives found matching your criteria.</div>';
        return;
      }

      grid.innerHTML = pageAlternatives.map(alt => `
        <div class="alternative-card">
          <div class="alternative-card__image">
            <img src="${alt.image || '/images/default-protocol.png'}" alt="${alt.title}" loading="lazy">
          </div>
          <div class="alternative-card__content">
            <h3 class="alternative-card__title">
              <a href="${alt.url}">${alt.title}</a>
            </h3>
            <p class="alternative-card__description">${alt.description}</p>
            <div class="alternative-card__category">${alt.category.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}</div>
          </div>
        </div>
      `).join('');
    }

    // Render pagination
    function renderPagination() {
      const pagination = document.getElementById('pagination');
      if (!pagination) return;

      const totalPages = Math.ceil(filteredAlternatives.length / ITEMS_PER_PAGE);

      if (totalPages <= 1) {
        pagination.innerHTML = '';
        return;
      }

      let paginationHTML = '<div class="pagination">';

      // Previous button
      if (currentPage > 1) {
        paginationHTML += `<button class="pagination__button" onclick="changePage(${currentPage - 1})">Previous</button>`;
      }

      // Page numbers
      const startPage = Math.max(1, currentPage - 2);
      const endPage = Math.min(totalPages, currentPage + 2);

      if (startPage > 1) {
        paginationHTML += `<button class="pagination__button" onclick="changePage(1)">1</button>`;
        if (startPage > 2) {
          paginationHTML += '<span class="pagination__ellipsis">...</span>';
        }
      }

      for (let i = startPage; i <= endPage; i++) {
        const activeClass = i === currentPage ? ' active' : '';
        paginationHTML += `<button class="pagination__button${activeClass}" onclick="changePage(${i})">${i}</button>`;
      }

      if (endPage < totalPages) {
        if (endPage < totalPages - 1) {
          paginationHTML += '<span class="pagination__ellipsis">...</span>';
        }
        paginationHTML += `<button class="pagination__button" onclick="changePage(${totalPages})">${totalPages}</button>`;
      }

      // Next button
      if (currentPage < totalPages) {
        paginationHTML += `<button class="pagination__button" onclick="changePage(${currentPage + 1})">Next</button>`;
      }

      paginationHTML += '</div>';
      pagination.innerHTML = paginationHTML;
    }

    // Change page
    window.changePage = function(page) {
      currentPage = page;
      renderAlternatives();
      renderPagination();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    // Event listeners
    const categoryFilter = document.getElementById('category-filter');
    const searchInput = document.getElementById('search-input');

    if (categoryFilter) {
      categoryFilter.addEventListener('change', function() {
        currentCategory = this.value;
        filterAlternatives();
      });
    }

    if (searchInput) {
      let searchTimeout;
      searchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          currentSearch = this.value;
          filterAlternatives();
        }, 300);
      });
    }

    // Initialize
    loadAlternatives();
  });
  </script>
</body>

</html>
